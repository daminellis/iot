#include <WiFi.h>
#include <ESPAsyncWebServer.h>
#include <Keypad.h>

// Substitua com suas credenciais WiFi
const char *ssid = "SEU_SSID";
const char *password = "SUA_SENHA_WIFI";

// Substitua com suas credenciais de IoT
const char *iotServer = "SEU_SERVIDOR_IOT";
const int iotPort = 80;

// Defina o número de linhas e colunas do teclado
const byte linhas = 4;
const byte colunas = 4;

// Defina os pinos do teclado
byte pinosLinhas[linhas] = {2, 3, 4, 5};
byte pinosColunas[colunas] = {6, 7, 8, 9};

// Inicializa o objeto Keypad
Keypad teclado = Keypad(makeKeymap("123A456B789C*0#D"), pinosLinhas, pinosColunas, linhas, colunas);

// Inicializa o objeto WiFi
WiFiClient client;

// Inicializa o objeto servidor web
AsyncWebServer server(80);

// Senha de exemplo (substitua com a sua senha real)
const String senhaCorreta = "1234";

void setup()
{
  Serial.begin(115200);

  // Conecta ao WiFi
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED)
  {
    delay(1000);
    Serial.println("Conectando ao WiFi...");
  }
  Serial.println("Conectado ao WiFi");

  // Rotas para a interface web
  server.on("/", HTTP_GET, [](AsyncWebServerRequest *request) {
    request->send(200, "text/html", "<html><body><form action='/abrir' method='post'>Senha: <input type='password' name='senha'><input type='submit' value='Abrir'></form></body></html>");
  });

  // Rota para abrir o cofre
  server.on("/abrir", HTTP_POST, [](AsyncWebServerRequest *request) {
    String senha = request->arg("senha");
    if (verificarSenha(senha))
    {
      // Adicione aqui o código para lidar com a abertura do cofre
      request->send(200, "text/plain", "Cofre aberto!");
    }
    else
    {
      request->send(401, "text/plain", "Senha incorreta!");
    }
  });

  // Inicia o servidor
  server.begin();
}

void loop()
{
  // Lê o teclado
  char tecla = teclado.getKey();
  if (tecla)
  {
    // Adicione aqui o código para lidar com a entrada do teclado
    // Exemplo: concatene a tecla a uma string e imprima no Serial
    Serial.print("Tecla Pressionada: ");
    Serial.println(tecla);
  }
  delay(10);
}

bool verificarSenha(String senha)
{
  // Substitua esta função com a lógica real de verificação de senha
  return senha.equals(senhaCorreta);
}
